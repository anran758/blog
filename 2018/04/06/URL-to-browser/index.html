<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/blog/images/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon/favicon-16x16.png"><link rel="mask-icon" href="/blog/images/favicon/logo.svg" color="#222"><link rel="manifest" href="/blog/images/favicon/site.webmanifest"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="hfSxUMVDQ0d4JZmyWsUce4uMULHxHXQxxCLYVk3cIbs"><meta name="msvalidate.01" content="D0E8CE815DEAA11708C153218034AA8E"><meta name="baidu-site-verification" content="CtPpLH5dio"><link rel="stylesheet" href="/blog/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"anran758.github.io",root:"/blog/",scheme:"Muse",version:"8.0.0-rc.3",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!0,color:"#222",save:"manual"},fancybox:!1,mediumzoom:!0,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!0,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="【多图长文预警，建议先码】在浏览器地址栏输入 URL 到页面渲染之间都经历了什么？这是一道很经典的问题，可以很全面的考验面试者对于网络知识的理解。这之间的过程是一环套一环，下面笔者通过这题来科普一下基础的网络知识。"><meta property="og:type" content="article"><meta property="og:title" content="初识网络原理: 从浏览器地址栏输入 URL 到页面渲染之间都经历了什么"><meta property="og:url" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/"><meta property="og:site_name" content="Anran758&#39;s blog"><meta property="og:description" content="【多图长文预警，建议先码】在浏览器地址栏输入 URL 到页面渲染之间都经历了什么？这是一道很经典的问题，可以很全面的考验面试者对于网络知识的理解。这之间的过程是一环套一环，下面笔者通过这题来科普一下基础的网络知识。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/search-word.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/url-example.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/dog_say.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/firefox-dns.png"><meta property="og:image" content="https://oldj.github.io/SwitchHosts/images/sh_light.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/dns-message.jpg"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/dns-capture-1.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/dns-res.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/dns-other-info.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/dns-queries.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/dns-table-class.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/dns-table-type.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/dns-res-answers.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/tcp-1.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/tls-1.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/tls-2.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/tls-3.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/tls-4.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/http-1.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/http-2.png"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/anima-2.gif"><meta property="og:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/Mozilla.gif"><meta property="og:image" content="https://pic1.zhimg.com/80/v2-7c35091abc2379395b66118e9740d024_hd.png"><meta property="article:published_time" content="2018-04-06T08:07:15.000Z"><meta property="article:modified_time" content="2021-10-04T09:19:41.491Z"><meta property="article:author" content="anran758"><meta property="article:tag" content="HTTP"><meta property="article:tag" content="TCP"><meta property="article:tag" content="DNS"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://anran758.github.io/blog/2018/04/06/URL-to-browser/search-word.png"><link rel="canonical" href="https://anran758.github.io/blog/2018/04/06/URL-to-browser/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>初识网络原理: 从浏览器地址栏输入 URL 到页面渲染之间都经历了什么 | Anran758's blog</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99223334-1"></script><script>if(CONFIG.hostname===location.hostname){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-99223334-1")}</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b333b085e93f238859c899fd8ca5bd3f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/blog/atom.xml" title="Anran758's blog" type="application/atom+xml">
</head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/blog/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Anran758's blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>时间轴</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/anran758/blog" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://anran758.github.io/blog/2018/04/06/URL-to-browser/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://avatars3.githubusercontent.com/u/23024075?s=96&v=4"><meta itemprop="name" content="anran758"><meta itemprop="description" content="web 开发的碎碎念"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Anran758's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">初识网络原理: 从浏览器地址栏输入 URL 到页面渲染之间都经历了什么</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-04-06 16:07:15" itemprop="dateCreated datePublished" datetime="2018-04-06T16:07:15+08:00">2018-04-06</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-10-04 17:19:41" itemprop="dateModified" datetime="2021-10-04T17:19:41+08:00">2021-10-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/blog/categories/%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">网络原理</span></a> </span></span><span id="/blog/2018/04/06/URL-to-browser/" class="post-meta-item leancloud_visitors" data-flag-title="初识网络原理: 从浏览器地址栏输入 URL 到页面渲染之间都经历了什么" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus：</span> <a title="disqus" href="/blog/2018/04/06/URL-to-browser/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/04/06/URL-to-browser/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>23k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>29 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>【多图长文预警，建议先码】在浏览器地址栏输入 URL 到页面渲染之间都经历了什么？这是一道很经典的问题，可以很全面的考验面试者对于网络知识的理解。这之间的过程是一环套一环，下面笔者通过这题来科普一下基础的网络知识。</p><span id="more"></span><p><strong>太长不看简易版</strong></p><ol><li>用户在浏览器输入 URL</li><li>浏览器尝试读取 URL 的缓存</li><li>无缓存则开始查 URL 域名的 ip，也就是 DNS 查找</li><li>开始建立 TCP 链接，经过三次握手成功建立连接</li><li>客户端开始发送数据</li><li>服务端将用户所需的资源返回给客户端</li><li>若返回的是 HTML 文档的话，浏览器开始解析 HTML 文档</li><li>构建 DOM 树、构建 CSSOM 树</li><li>将解析步骤中创建的 CSSOM 树和 DOM 树合成为 Render 树，然后用于计算每个可见元素的布局，最后将其绘制到屏幕上</li></ol><hr><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul><li><a href="#%E5%9C%B0%E5%9D%80%E6%A0%8F">地址栏</a></li><li><a href="#url">URL</a></li><li><a href="#ip-%E5%9C%B0%E5%9D%80">IP 地址</a><ul><li><a href="#ipv4">IPv4</a></li><li><a href="#%E5%88%86%E7%B1%BB%E7%BD%91%E7%BB%9C">分类网络</a></li><li><a href="#%E5%85%B6%E4%BB%96%E5%88%86%E9%85%8D%E6%96%B9%E6%A1%88">其他分配方案</a></li><li><a href="#ipv6">IPv6</a></li></ul></li><li><a href="#%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9Fdns">域名系统(DNS)</a><ul><li><a href="#dns">DNS</a></li><li><a href="#%E6%9C%AC%E5%9C%B0-dns">本地 DNS</a></li><li><a href="#hosts">hosts</a></li><li><a href="#%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90">域名解析</a></li></ul></li><li><a href="#tcp-%E8%BF%9E%E6%8E%A5">TCP 连接</a></li><li><a href="#https-ssltsl">HTTPS (SSL/TSL)</a></li><li><a href="#http">HTTP</a></li><li><a href="#%E6%B8%B2%E6%9F%93%E6%96%87%E6%A1%A3">渲染文档</a></li><li><a href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB">扩展阅读</a></li><li><a href="#%E5%90%8E%E8%AE%B0">后记</a></li></ul><h2 id="地址栏"><a href="#地址栏" class="headerlink" title="地址栏"></a>地址栏</h2><p>当我们在浏览器地址栏输入信息时，浏览器就已经开始进行工作了。首先它会监听我们输入的信息并尝试匹配出你想要访问的网址或关键词，以 <code>chrome</code> 为例，它会猜我们想要什么，给出下面的建议项：</p><ul><li>使用默认搜索引擎搜索关键字</li><li>书签，历史记录和最近下载中存储的其他链接</li><li>使用默认搜索引擎的相关关键字搜索选项</li></ul><p>我们在地址栏输入知乎首页的链接 <code>zhihu.com</code> 后敲下回车，命令浏览器搜索信息。接着大致会对输入的信息进行以下判断:</p><ol><li>看看输入的是不是一个合法的 <code>URL</code> 链接。</li><li>若是则判断输入的 URL 是否完整。不完整的话，浏览器可能会对域猜测，也就是说尝试通过在输入的内容中添加前缀、后缀或两者来 “补全” <code>URL</code>。比如输入 <code>zhihu.com</code> 则可能会在前面添加 <code>www</code>。</li><li>否，那就将输入的内容作为搜索的条件，使用用户设置的默认搜索引擎来进行搜索</li></ol><img data-src="/blog/2018/04/06/URL-to-browser/search-word.png" title="输入了不规范的 URL"><p>浏览器根据我们输入的信息判断出 <code>zhihu.com</code> 是一个合法 <code>URL</code>，并被补全为 <code>www.zhihu.com</code>。</p><p><strong>本章参考资料:</strong></p><ul><li><a target="_blank" rel="noopener" href="https://www.webnots.com/how-to-use-google-chrome-address-bar-for-search/">How to Use Google Chrome Address Bar for Search?</a></li><li><a target="_blank" rel="noopener" href="http://kb.mozillazine.org/Location_Bar_search">Location Bar search(Firfox 地址栏的详细行为)</a></li></ul><hr><h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>经常上网的朋友经常能听说 <code>URL</code> 这个名词，那么它具体是干嘛用的呢？</p><p><code>URL</code> 全称为**统一资源定位系统(uniform resource locator)**，用于表示一个因特网(Internet)上标准的资源的地址。就像每户人家都会有个门牌地址一样。维基百科对 <code>URL</code> 的术语上是这样解释：</p><p>每个 <code>HTTP URL</code> 都符合通用 <code>URI</code> 的语法(关于 <code>URL</code> 与 <code>URI</code> 的差别参请看下文的列参考资料)。<code>URI</code> 一般语法由五个的分层序列的组分：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">URI &#x3D; scheme:[&#x2F;&#x2F;authority]path[?query][#fragment]</span><br><span class="line"></span><br><span class="line">URI &#x3D; 方案:[&#x2F;&#x2F;授权]路径[?查询][#片段ID]</span><br></pre></td></tr></table></figure><p>权限组件 (authority) 又分为三个子组件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authority &#x3D; [userinfo@]host[:port]</span><br></pre></td></tr></table></figure><p>它在语法图表示为：</p><img data-src="/blog/2018/04/06/URL-to-browser/url-example.png"><p>从术语上看好像有点抽象？没有关系，我们通过浏览器内部提供的 <code>location</code> 的接口来辅助理解，该接口表示其链接到的对象的位置（URL）。</p><p>我们另开一个标签页，随便打开一个较为复杂的 URL，如:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;anran758&#x2F;Front-End-Lab&#x2F;tree&#x2F;master&#x2F;css?name&#x3D;anran758&amp;uid&#x3D;234098&amp;shareId&#x3D;456#layout</span><br></pre></td></tr></table></figure><p>接着在控制台的 <code>Console</code> 面板中直接输入 <code>location</code> 并敲下回车，它会输出一个对象，该对象内包含当前页面上的 URL 信息。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;https://github.com/anran758/Front-End-Lab/tree/master/css?name=anran758&amp;uid=234098&amp;shareId=456#layout&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ancestorOrigins&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;origin&quot;</span>: <span class="string">&quot;https://github.com&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;https:&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;github.com&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;hostname&quot;</span>: <span class="string">&quot;github.com&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;port&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pathname&quot;</span>: <span class="string">&quot;/anran758/Front-End-Lab/tree/master/css&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;search&quot;</span>: <span class="string">&quot;?name=anran758&amp;uid=234098&amp;shareId=456&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;hash&quot;</span>: <span class="string">&quot;#layout&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们拿这个对象与 URL 的属于一一对应，就可以清晰看出他们之间的对应关系:</p><table><thead><tr><th>URL 术语</th><th>location 对象的 key</th><th>匹配项</th></tr></thead><tbody><tr><td>scheme</td><td>protocol</td><td><code>https</code></td></tr><tr><td>host</td><td>hostname</td><td><code>github.com</code></td></tr><tr><td>path</td><td>pathname</td><td><code>/anran758/Front-End-Lab/tree/master/css</code></td></tr><tr><td>query</td><td>search</td><td><code>?name=anran758&amp;uid=234098&amp;shareId=456</code></td></tr><tr><td>fragment</td><td>hash</td><td><code>#layout</code></td></tr></tbody></table><ul><li><code>scheme</code>(方案)，多时候情况下也称为 <code>protocol</code>(协议)，尾部跟随一个 <code>:</code> 作为分隔</li><li><code>host</code>(主机名), 它可以是一个 IP 或是一个域名(下文会讲解两者的概念)</li><li><code>path</code>(路径)，以 <code>/</code> 区别每一层目录结构的名称。</li><li><code>query</code>(查询)，以 <code>?</code> 为起点，以 <code>&amp;</code> 分隔键值。<br>在上例中 <code>name</code> 就是键，<code>anran758</code> 就是值。在页面上，前端可以通过 <code>URL</code> 来传递参数；在接口上，后端可以根据 <code>GET</code> 请求取得对应查询条件</li><li><code>fragment</code>(片段)，以 <code>#</code> 为起点的部分。我们通常称这部分为哈希，它在浏览器上有特殊的作用。<br>如果页面上存在一个 <code>id=layout</code> 的元素，那么页面就会滚动到该元素之上。就像我们打开上面给出的示例 <code>URL</code> 后，页面加载后自动滚动在标题为 <code>layout</code> 上。</li></ul><p>以上是我们在地址栏中常见的 <code>URL(URI)</code> 格式，但不够全面。比方说我们带上端口后，直接访问 <code>https://github.com:443</code> 会发现地址栏上并没有显示出端口号，这是为什么呢？</p><p>这是因为如果我们访问的 <code>URL</code> 使用的是以 <code>https</code> 开头的协议，那么 <code>HTTPS</code> 协议的默认的端口就是 <code>443</code>。即便我们特意补全这个端口号，浏览器还是默认会将该端口隐去。</p><p>同理，我们访问的是 <code>http</code> 协议，他的默认端口是 <code>80</code> 端口，也会自动隐藏掉。只有当我们访问与该协议默认端口不一致时，浏览器才会显示出来。比如 <code>http://localhost:8000/analysis/project</code> 就能看到它能在地址栏上正确的显示出来(笔者这里是以 <code>chrome</code> 浏览器为例，不同浏览器可能有不同的行为)。</p><p>完整的 <code>URL</code> 例子可以参见维基百科给出的示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">        userinfo       host      port</span><br><span class="line">        ┌──┴───┐ ┌──────┴──────┐ ┌┴┐</span><br><span class="line">https:&#x2F;&#x2F;john.doe@www.example.com:123&#x2F;forum&#x2F;questions&#x2F;?tag&#x3D;networking&amp;order&#x3D;newest#top</span><br><span class="line"> └─┬─┘  └───────────┬──────────────┘└───────┬───────┘ └───────────┬─────────────┘ └┬┘</span><br><span class="line">scheme          authority                  path                 query           fragment</span><br><span class="line"></span><br><span class="line">ldap:&#x2F;&#x2F;[2001:db8::7]&#x2F;c&#x3D;GB?objectClass?one</span><br><span class="line">└┬─┘   └─────┬─────┘└─┬─┘ └──────┬──────┘</span><br><span class="line">scheme   authority   path      query</span><br><span class="line"></span><br><span class="line">mailto:John.Doe@example.com</span><br><span class="line">└─┬──┘ └────┬─────────────┘</span><br><span class="line">scheme     path</span><br><span class="line"></span><br><span class="line">news:comp.infosystems.www.servers.unix</span><br><span class="line">└┬─┘ └─────────────┬─────────────────┘</span><br><span class="line">scheme            path</span><br><span class="line"></span><br><span class="line">tel:+1-816-555-1212</span><br><span class="line">└┬┘ └──────┬──────┘</span><br><span class="line">scheme    path</span><br><span class="line"></span><br><span class="line">telnet:&#x2F;&#x2F;192.0.2.16:80&#x2F;</span><br><span class="line">└─┬──┘   └─────┬─────┘│</span><br><span class="line">scheme     authority  path</span><br><span class="line"></span><br><span class="line">urn:oasis:names:specification:docbook:dtd:xml:4.1.2</span><br><span class="line">└┬┘ └──────────────────────┬──────────────────────┘</span><br><span class="line">scheme                    path</span><br></pre></td></tr></table></figure><hr><p>接着浏览器分析 URL 信息后，会从 URL 取出方案(协议类型)。这个方案可以是常见的 <code>http:</code>，也可以像 chrome 内置协议 <code>chrome:</code>。再根据不同的协议进行不同的解析。</p><p>我们在地址栏上输入的是 <code>zhihu.com</code>，没有指定要使用哪个协议，那这个这个判断的权利交给了浏览器，浏览器通过内置的方案来决定对 <code>URL</code> 信息进行补全。比如 <code>chrome</code> 可能会对该链接补全为 <code>https://www.zhihu.com</code>。</p><p>接着浏览器从 <code>URL</code> 中提取出主机名(<code>host</code>)信息。它可能是一个 IP 地址，也可以可能是一个域名地址。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">              host    port</span><br><span class="line">        ┌──────┴────┐ ┌┴┐</span><br><span class="line">https:&#x2F;&#x2F;www.zhihu.com:443&#x2F;</span><br><span class="line">└─┬─┘ └────────┬────────┘</span><br><span class="line">scheme     authority</span><br><span class="line"></span><br><span class="line">            host     port</span><br><span class="line">       ┌─────┴─────┐ ┌┴─┐</span><br><span class="line">http:&#x2F;&#x2F;192.168.6.106:8000&#x2F;</span><br><span class="line">└─┬─┘ └────────┬────────┘</span><br><span class="line">scheme     authority</span><br></pre></td></tr></table></figure><p>下面来了解一下关于 <code>IP 地址</code>和<code>域名</code>这两个概念。</p><p><strong>本章参考资料:</strong></p><ul><li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Learn/Common_questions/What_is_a_URL">什么是 URL？</a></li><li><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/xml/x-urlni.html">分清 URI、URL 和 URN</a></li><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Uniform_Resource_Identifier">Uniform Resource Identifier(统一资源定位符)</a></li></ul><hr><h2 id="IP-地址"><a href="#IP-地址" class="headerlink" title="IP 地址"></a>IP 地址</h2><p>因特网(Internet)就像个学校，每个资源都有自己的座位。当你获取某个资源时，首先需要确定资源的所在地，就像你要去别人家取货那起码得知道人家的地址。</p><p><strong>IP 地址(Internet Protocol Address)</strong> 就是用于标识网络上设备的数据标签，也可以通俗的理解为住宅门牌号。它主要有 <code>IPv4</code>、<code>IPv6</code> 两个版本。</p><h3 id="IPv4"><a href="#IPv4" class="headerlink" title="IPv4"></a>IPv4</h3><p><code>IPv4</code> 使用 32 位地址, 地址空间为 <code>4,294,967,296(2^32)</code>。它有 3 种常见的标记法，即：二进制标记法、点分十进制标记法、十六进制标记法，其中最常采用的标记法是方便人们记忆的点分十进制。以下是三者之间的比较:</p><table><thead><tr><th>IPv4 标记法</th><th>表示方式</th></tr></thead><tbody><tr><td>二进制</td><td>11000000 10101000 00000001 00000001</td></tr><tr><td>点分十进制</td><td>192.168.1.1</td></tr><tr><td>十六进制</td><td>0xC0A80101</td></tr></tbody></table><p><code>IPv4</code> 早已在我们身边普及。比方说我们需要重设 WIFI 密码，那得要登录路由器厂商提供的路由器管理后台(Admin)，这个管理后台的登录地址通常是厂商默认设置的本地 IP 地址，如 <code>192.168.1.1</code>。</p><p>在 IPv4 的原始设计中，IP 地址分为两部分，分别是 <strong>8 位网络地址</strong>和 <strong>24 位主机位</strong>。因为局域网早期出现时，只有一些又大又少的网络。这种结构最多允许有 256 个网络，很快就发现这种结构完全不够用。</p><h3 id="分类网络"><a href="#分类网络" class="headerlink" title="分类网络"></a>分类网络</h3><p>为了克服这个限制，1981 年的 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc791">RFC 791</a> 对 IP 地址定义进行了修改，定义了<strong>分类地址结构</strong>。修订后系统定义了五个类，分别是 A、B、C、D、E 五类。以下是分类地址结构的 IPv4 地址空间划分表:</p><table><thead><tr><th>类</th><th>地址范围</th><th>高序位</th><th>用途</th><th>百分比</th><th>网络地址位数</th><th>主机位数</th><th>网络数</th><th>每个网络的主机数</th></tr></thead><tbody><tr><td>A</td><td>0.0.0.0 ~ 127.255.255.255</td><td>0</td><td>单播/特殊</td><td>1/2(128/256)</td><td>8</td><td>24</td><td>128</td><td>16,777,216</td></tr><tr><td>B</td><td>128.0.0.0 ~ 191.255.255.255</td><td>10</td><td>单播/特殊</td><td>1/4</td><td>16</td><td>16</td><td>16384</td><td>65,536</td></tr><tr><td>C</td><td>192.0.0.0 ~ 223.255.255.255</td><td>110</td><td>单播/特殊</td><td>1/8</td><td>24</td><td>8</td><td>2,097,152</td><td>256</td></tr><tr><td>D</td><td>224.0.0.0 ~ 239.255.255.255</td><td>1110</td><td>组播</td><td>1/16</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td></tr><tr><td>E</td><td>240.0.0.0 ~ 255.255.255.255</td><td>11110</td><td>保留</td><td>1/16</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td></tr></tbody></table><p>我们从表中可以得知，A、B、C 类用于为因特网(单播地址)中的接口分配地址，还有一些在特殊情况下使用不被分配的 IP。</p><p>单播和组播的概念很好理解。单播是指客户端与服务器之间的点到点连接。就像你跟小姐姐聊天是一对一之间的交流。</p><p>组播则是指在发送和接收者实现点对多点连接。下面二狗子的表情包很精准的阐述出组播的概念：</p><p>二狗子突然站起来对圈子(组播组)里的其他朋友说：”大家听我说，我发现我们都是狗！！”。二狗子发出了一条消息，组播组内的其他狗子同时接收到了这条消息。</p><img data-src="/blog/2018/04/06/URL-to-browser/dog_say.png"><p>使用分类地址划分后，不同类地址可以拥有不同规模的网络数和主机数。比如，A 类地址仅能分配 128 个网络给不同站点用，但一个网络内分配给 <code>16,777,216(2^24)</code> 台主机使用。而 C 类地址虽然能分配 <code>2,097,152(2^21)</code> 个网络，但每个网络只能容纳 256 台主机。这样就可以预先估计规模大小，然后再申请分类分配网络号，解决了早期不够用的问题。</p><h3 id="其他分配方案"><a href="#其他分配方案" class="headerlink" title="其他分配方案"></a>其他分配方案</h3><p>随着互联网发展，分类网络的形式使得很多地址空间没有被合理的利用上，C 类地址不足以承载太大的网站，进而去申请 B 类地址。导致 B 类地址迅速减少。IP 地址不够用的情况又出现了。为了解决这些情况，RFC 在基于 IPv4 地址上提出了以下的方案:</p><blockquote><p>1985 年，随着 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc950">RFC 950</a> 的发布，开始将现有的分类网络划分为子网。随后在 1987 年发布的 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1109">RFC 1109</a> 中引入可变长度子网掩码(VLSM)，该划分变得更加灵活。</p><p>1993 年，基于可变长度子网掩码 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1517">RFC 1517</a> 引入了无类域间路由(CIDR), 正式地取代了分类网络，分类网络也因此被称为“有类别”的。</p><p>CIDR 被设计为可以重新划分地址空间，因此小的或大的地址块均可以分配给用户。CIDR 创建的分层架构由互联网号码分配局（IANA）和区域互联网注册管理机构（RIR）进行管理，每个 RIR 均维护着一个公共的 WHOIS 数据库，以此提供 IP 地址分配的详情。</p><p>– 以上 IPv4 地址方案发展历史截取至维基百科</p></blockquote><h3 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h3><p>虽然通过以上几种 IPv4 地址分配方案缓解地址耗盡的问题，但还是治标不治本。为了彻底解决 <code>IPv4</code> 地址耗盡的问题，1998 年对使用 128 位 IP 地址的 IP（IPv6）新版本进行了标准化。</p><p><code>IPv6</code> 地址的出现不仅解决了 IPv4 地址空间不够的问题，还实现了 IPv4 中不存在的功能。</p><p>在 IPv6 中，地址大小从 IPv4 中的 32 位增加到 128 位，从而提供了多达 2128 个（大约 <code>3.403 × 10^38</code>）地址。这个数字什么概念呢？我们以维基百科统计的世界人口来对比。截止至 2019.05，世界人口约为 77 亿人(7.7 × 10^9）。因此在可预见的未来里，这被认为是够用了的。</p><p><code>IPv6</code> 地址为 128 位元长，但通常写作 8 组，每组 4 个<strong>十六进制数</strong>的形式。如果四个数字都是 0，可以被省略。例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2001:0db8:85a3:0000:1319:8a2e:0370:7344</span><br><span class="line"></span><br><span class="line"># 上面的 IPv6 等价于下面这条。注意双冒号</span><br><span class="line">2001:0db8:85a3::1319:8a2e:0370:7344</span><br></pre></td></tr></table></figure><p>为避免 <code>IPv6</code> 地址的冒号与方案的冒号冲突，在 <code>IPv6</code> 地址在 URL 上是通过中括号包裹，以百度的 IPv6 地址为例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;[2400:da00:2::29]&#x2F;</span><br><span class="line"></span><br><span class="line"># 等价于</span><br><span class="line">http:&#x2F;&#x2F;ipv6.baidu.com&#x2F;</span><br></pre></td></tr></table></figure><p>目前我们见到更多的是 <code>IPv4</code> 地址。IPv6 是未来的主流，目前仍然在部署中。国内的部署情况可以在百度百科《<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/IPv6/172297?fr=aladdin#1">IPv6</a>》的发展历史中能找到相关的描述:</p><blockquote><p>2018 年 6 月，三大运营商联合阿里云宣布，将全面对外提供 IPv6 服务，并计划在 2025 年前助推中国互联网真正实现“IPv6 Only” 。<br>7 月，百度云制定了中国的 IPv6 改造方案。<br>8 月 3 日，工信部通信司在北京召开 IPv6 规模部署及专项督查工作全国电视电话会议，中国将分阶段有序推进规模建设 IPv6 网络，实现下一代互联网在经济社会各领域深度融合。<br>11 月，国家下一代互联网产业技术创新战略联盟在北京发布了中国首份 IPv6 业务用户体验监测报告显示，移动宽带 IPv6 普及率为 6.16%，IPv6 覆盖用户数为 7017 万户，IPv6 活跃用户数仅有 718 万户，与国家规划部署的目标还有较大距离。</p><p>2019 年 4 月 16 日，工业和信息化部发布《关于开展 2019 年 IPv6 网络就绪专项行动的通知》。5 月，中国工信部称计划于 2019 年末，完成 13 个互联网骨干直联点 IPv6 的改造。</p></blockquote><p>好啦，关于 IP 地址的基础概念就讲到这里。关于 IP 地址更深入的知识可以去找相关的专业教材或书籍，本文将不过多赘述。</p><p><strong>本章参考资料:</strong></p><ul><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IP_address">IP address | wikipedia(英)</a></li><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IPv4">IPv4 | wikipedia(英)</a></li><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IPv6">IPv6 | wikipedia(英)</a></li><li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/IPv6/172297?fr=aladdin#1">IPv6 | 百度百科</a></li><li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%96%E7%95%8C%E4%BA%BA%E5%8F%A3">世界人口 | wikipedia(中)</a></li></ul><hr><h2 id="域名系统-DNS"><a href="#域名系统-DNS" class="headerlink" title="域名系统(DNS)"></a>域名系统(DNS)</h2><p>理论上我们直接使用 IP 地址就可以访问资源了。但直接通过 IP 地址来访问会存在一个问题，那就是 IP 地址不便于人类记忆。考虑以下场景对话:</p><p>“嘿朋友。最近我做了个主页，有空来我留言板踩踩呗？”，”没问题呀，那么地址是什么呢？”。(以下弹出一个选项框)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">选项A: http:&#x2F;&#x2F;[2400:da00:2::29]&#x2F;</span><br><span class="line">选项B: http:&#x2F;&#x2F;183.232.231.174&#x2F;</span><br><span class="line">选项C: http:&#x2F;&#x2F;www.baidu.com&#x2F;</span><br></pre></td></tr></table></figure><p>将上面三个选项进行对比就能发现：如果我们十分硬核的选择了 A、B 两项，那你的朋友可能会给你翻个白眼。这样的地址谁想记呀！！即便是朋友愿意记下你的 IP 地址，但把该网站的定位转为商业网站后，显然这就有点为难用户了。</p><blockquote><p>tips: 在命令行使用 <code>nslookup baidu.com</code> 可以获得百度的 ip 地址</p></blockquote><p>因此，为了克服 IP 地址不便于人类记忆和理解的情况，人们设计出<strong>域名</strong>来辅助记忆。</p><p><strong>域名(Domain)</strong> 在术语上定义，是由一串用点分隔的字符组成的互联网上某一台计算机或计算机组的名称，用于在数据传输时标识计算机的电子方位。它有一定的自然语言含义。所以它相当于是 IP 地址的一个映射。</p><p>你不是 IP 地址记不住吗？那我把 IP 地址映射为人们熟知的拼音语句、英语单词等常见词语。<code>183.232.231.174</code> 我可以映射为 <code>taobao.com</code> 、 <code>baidu.com</code> 、<code>12306.cn</code>。这样是不是好记多了？</p><p>确实，IP 地址被映射为域名后，人们记域名方便方便多了。但问题又来了，底层计算机并不认识域名这种东西、它寻址还是得通过 IP 地址来寻址。发起请求时需要有应用告诉计算机这个域名的 IP 地址是什么。</p><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p><strong>域名系统(Domain Name System, 下文统一简称为 DNS)</strong> 的任务就是负责将域名解析为 IP 地址。这个解析的过程也被称为 **名称解析(name resulution)**。</p><p><code>DNS</code> 是互联网上重要的基础应用程序，它作为一个分布式数据库，域名服务器分布在世界各地，储存着域名与 IP 地址的映射关系，每个域名服务器上值存储了部分域名信息。因此为了完成域名解析，通过需要在多个域名服务器之间进行查询。</p><p><code>DNS</code> 为了实现域名的有效管理与高效的查询，它是按层级结构进行组织的，并且该层次结构与域名的结构( <code>.</code> 分隔)相对应，每个以点分隔的为 标签(<code>label</code>)。它所使用的所有名称集合构成了 DNS **名称空间(name space)**。</p><p>当前的名称空间是一棵域名树结构，位于顶部的树根(<code>root</code>, 通常为我们称之为根域名服务器)为命名。树第一层为**顶级域名(Top level Domian, TDL)**，TDL 再往下就是子域名。域名的层级是从右往左看:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">三级域名.二级域名.顶级域名.根域名</span><br><span class="line"></span><br><span class="line">三级域名    顶级域名</span><br><span class="line">  ┌┴┐       ┌┴┐</span><br><span class="line">  www.zhihu.com</span><br><span class="line">      └─┬─┘</span><br><span class="line">     二级域名</span><br></pre></td></tr></table></figure><p>因此 <code>www.zhihu.com</code> 完整的域名应该是 <code>www.zhihu.com.</code>。后面的 <code>.</code> 相当于 <code>.root</code>，由于每个域名的根节点都是 <code>root</code>，因此 <code>.root</code> 就被省略为 <code>.</code>。我们直接访问 <code>zhihu.com.</code> 是能正确的打开知乎首页的。</p><hr><p>一个服务器所管辖的范围叫做区(zone)。每一个区设置相应的权威域名服务器，用于保存该区中所有的主域名到 IP 地址的映射。其中 DNS 服务器的管辖范围不是以 “域” 为单位，而是以 “区” 为单位。域名服务器根据其主要保存的域名信息以及在域名解析过程中的作用等，可以分为根域名服务器、顶级域名服务器、权威域名服务器。</p><p><strong>根域名服务器</strong>是最重要的域名服务器，因为所有域名解析操作均离不开它们。在因特网上指定了 13 个逻辑根名称服务器，逻辑名称的格式为字母 <code>.root-servers.net</code>，字母范围从 a 到 m。如: <code>a.root-servers.net</code>、<code>d.root-servers.net</code> 等。</p><p><strong>顶级域名服务器</strong>负责管理在该顶级域名服务器注册的所有二级域名。顶级域名服务器的名称对应着域名的最后一个名称。如 <code>www.zhihu.com</code> 的顶级域名服务器名称是 <code>com</code>。</p><p><strong>权威域名服务器</strong>，负责一个区的域名服务器，保存该区中的所有主机的域名到 IP 地址的映射。任何一个拥有域名的主机，其域名与 IP 地址的映射关系等信息都存储在所在网络的权威域名服务器上。在进行域名解析时，只要找到被查询域名主机注册的权威域名服务器，就可以获得该域名对应的 IP 地址信息。</p><h3 id="本地-DNS"><a href="#本地-DNS" class="headerlink" title="本地 DNS"></a>本地 DNS</h3><p>任何一台主机(PC、手机等)在网络地址配置时，都会配置一个 DNS 服务器作为默认域名服务器，这样这台主机在任何时候需要进行域名解析，都会将域名查询发送给该服务器，这个默认服务器我们称之为本地域名服务器。在 MacOS 环境下可以输入以下命令来查看 DNS 的配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">➜  blog git:(master) ✗ scutil --dns</span><br><span class="line">DNS configuration</span><br><span class="line"></span><br><span class="line">resolver #1</span><br><span class="line">  nameserver[0] : 172.20.10.1</span><br><span class="line">  if_index : 5 (en0)</span><br><span class="line">  flags    : Request A records</span><br><span class="line">  reach    : 0x00020002 (Reachable,Directly Reachable Address)</span><br><span class="line"></span><br><span class="line">resolver #2</span><br><span class="line">  domain   : local</span><br><span class="line">  options  : mdns</span><br><span class="line">  timeout  : 5</span><br><span class="line">  flags    : Request A records</span><br><span class="line">  reach    : 0x00000000 (Not Reachable)</span><br><span class="line">  order    : 300000</span><br><span class="line"></span><br><span class="line">resolver #3</span><br><span class="line">  domain   : 254.169.in-addr.arpa</span><br><span class="line">  options  : mdns</span><br><span class="line">  timeout  : 5</span><br><span class="line">  flags    : Request A records</span><br><span class="line">  reach    : 0x00000000 (Not Reachable)</span><br><span class="line">  order    : 300200</span><br><span class="line"></span><br><span class="line">resolver #4</span><br><span class="line">  domain   : 8.e.f.ip6.arpa</span><br><span class="line">  options  : mdns</span><br><span class="line">  timeout  : 5</span><br><span class="line">  flags    : Request A records</span><br><span class="line">  reach    : 0x00000000 (Not Reachable)</span><br><span class="line">  order    : 300400</span><br><span class="line"></span><br><span class="line"># 省略其他配置信息..</span><br><span class="line"></span><br><span class="line">DNS configuration (for scoped queries)</span><br><span class="line"></span><br><span class="line">resolver #1</span><br><span class="line">  nameserver[0] : 172.20.10.1</span><br><span class="line">  if_index : 5 (en0)</span><br><span class="line">  flags    : Scoped, Request A records</span><br><span class="line">  reach    : 0x00020002 (Reachable,Directly Reachable Address)</span><br></pre></td></tr></table></figure><p>从缓存的角度来看，有分 DNS 服务器缓存和应用级 DNS 缓存。</p><p>浏览器向 DNS 服务器发起请求，DNS 会从自己的缓存中读取记录，如没有结果才向上一层请求，这是属于应用级缓存。<code>chrome</code> 早期可以通过访问 <code>chrome://net-internals/#dns</code> 来查看浏览器缓存的 DNS 记录，但不知什么原因现在把查看 DNS 信息的页面给砍掉了，只留清除 DNS 缓存的功能。而 <code>Firefox</code> 可以直接访问 <code>about:networking#dns</code> 查看对应的域名映射。</p><img data-src="/blog/2018/04/06/URL-to-browser/firefox-dns.png"><h3 id="hosts"><a href="#hosts" class="headerlink" title="hosts"></a>hosts</h3><p>除了 DNS 服务器与 DNS 缓存外，其实还有一种途径能读取域名映射，那就是 <code>hosts</code> 文件。</p><p><code>hosts</code> 文件是纯文本文件。从历史的角度看，<code>hosts</code> 文件出现的比 DNS 服务器还早。最初在 Internet 的前身 ARPANET 中，其成员 SRI International 手动维护并分享的一个名为 HOSTS.TXT 的文件。它负责将主机名称映射到相应的 IP 地址。</p><p>由于个人网络不断庞大之后，对 hosts 文件进行管理的难度也越来越大，于是在 1983 年 DNS 系统开始开发，1984 年得到了发展。并且随着网络的发展，DNS 可以自动提供动态的主机名解析，因此 <code>hosts</code> 成为了一个可以作为备用手段的名称解析机制。</p><p>与 DNS 不同的是，hosts 文件是可以由用户改写的，是属于操作系统级别的 IP 地址映射。同时在一些操作系统上，hosts 文件可能会比其他域名解析器(如 DNS 服务器)会具有更高的优先级。</p><p>hosts 文件在不同操作系统下路径是不一样的。以下给出常见的操作系统路径：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># win7 +, %SystemRoot%\ 系统根路径默认为 c 盘，也就是 c:\</span><br><span class="line">%SystemRoot%\System32\drivers\etc\hosts</span><br><span class="line"></span><br><span class="line"># Unix、类Unix系统（例如 Linux、MacOs 等）</span><br><span class="line">/etc/hosts</span><br></pre></td></tr></table></figure><p>hosts 文件内容由第一行文本字段中的 IP 地址和<strong>一个或多个主机名</strong>组成的文本行。每个字段都用空格隔开(出于历史原因，通常首选使用 Linux 上的 hosts 直接复制到 window 上可能不会生效)。井号(#) 后文字为注释信息，文件中的完全空白行将被忽略。典型的主机文件可能包含以下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1       localhost</span><br><span class="line">::1             localhost</span><br></pre></td></tr></table></figure><p>除此之外，hosts 文件还可以做其他用途。</p><p>比如原本我们开发环境的 URL 可能是 <code>192.168.6.106:8000</code>, 现在页面上有一个强依赖于当前 URL 域名的功能或校验。但我们得要完成测试开发，这怎么办呢？总不能先部署上线再测试吧，这多麻烦呀..</p><p>这里就可以通过修改本地的 hosts 文件，将 <code>192.168.6.106</code> 映射 <code>www.example.com</code>，然后我们直接访问 <code>www.example.com:8000</code> 进行测试即可。</p><p>再比如，我们浏览器可能会装有广告拦截插件，但总有一些漏网之鱼怎么办？没有关系，我们直接在浏览器控制台打开 <code>Network</code>, 找到广告的地址，将该域名映射为本地专用网络 <code>127.0.0.1</code> 上。那该页面发起的广告请求将不能正常的获取到资源，也是一种屏蔽广告的好方法。</p><p>可以做一个简单的测试。打开 <code>hosts</code> 文件，修改以下映射(需要管理员权限)，再打开匿名模式访问百度首页，然后会发现浏览器提示: <code>无法访问此网站 baidu.com 拒绝了我们的连接请求。</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1       localhost baidu.com</span><br><span class="line">::1             localhost</span><br></pre></td></tr></table></figure><p>修改 hosts 文件能我们提供一些便利，但同时也要防止有人恶意篡改我们的 hosts 文件(通过病毒等途径)，引导至诈骗网站。</p><p>hosts 文件是系统文件，直接通过路径找 hosts 文件对于一些朋友来说感觉会有点繁琐。因此在不同操作系统下有开发者开发了这方面的便捷工具，如 MacOS 上可以下载 <a target="_blank" rel="noopener" href="https://oldj.github.io/SwitchHosts/">SwitchHosts</a> 来辅助修改，也可以在其官网上查看它提供了哪些功能。</p><p><img data-src="https://oldj.github.io/SwitchHosts/images/sh_light.png" alt="SwitchHosts Preview"></p><h3 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h3><p>现在我们回归主线，对以上本地 DNS 解析的优先级做一个梳理：</p><p>在地址栏输入 URL 的主机名是域名的话，那么浏览器将会调用域名解析器。这个域名解析器的优先级可能根据操作系统的不同会有所差异：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">浏览器 DNS 缓存 &gt; hosts 文件(或 hosts 文件 &gt; 浏览器 DNS 缓存) &gt; 本地 DNS 服务器 &gt; ISP(因特网提供商) DNS 服务器</span><br></pre></td></tr></table></figure><p>现在我们假设浏览器缓存会被最先查找，正式来了解域名解析的过程:</p><p><strong>一、</strong> 首先浏览器从 URL 提取出主机名，从浏览器 DNS 缓存中查找是否有对应的记录。</p><p><strong>二、</strong> 应用缓存中没有找到记录的话，会进一步查找 hosts 文件是否有记录映射关系，有则停止下一步查找，并返回结果。</p><p><strong>三、</strong> 如果前两步骤都没有找到对应的映射地址的话，将会向本地 DNS 服务器发送请求。以下对本步骤进行详细讲解：</p><p>要了解 DNS 查询细节的话，那得先学习一下 DNS 的信息格式，然后我们可以安装 <a target="_blank" rel="noopener" href="https://www.wireshark.org/">Wireshark</a> 捕获请求分组来辅助学习：</p><img data-src="/blog/2018/04/06/URL-to-browser/dns-message.jpg" title="dns message"><p>安装该软件后，点击<strong>开始捕获分组</strong>并在过滤器上输入 <code>dns</code> 后敲回车。接着在浏览器上访问 <code>zhihu.com</code> 捕获到如下数据：</p><img data-src="/blog/2018/04/06/URL-to-browser/dns-capture-1.png"><p>从上图选中数据报的头部可以看出，这是是一个 <code>UDP/IPv4</code> 数据报，同时数据报带有 DNS 头部信息。</p><p>这是一个标准的 DNS 查询，发送端 IP 地址是 <code>172.20.10.7</code>, 端口号为临时分配的 <code>49246</code>。这个数据报发往本地 DNS 服务器 <code>172.20.10.1</code>，端口号为知名 DNS 端口 <code>53</code>.</p><p>把 DNS 头部信息与 DNS message 格式进行对比就能得知，<code>Transaction ID</code> 就是 占 16 个比特位(以下单位简称为位)的 <code>ID</code>，其值为 <code>0x420a</code>。</p><p><code>flags</code> 的标记可以得知该 DNS 消息的状态与类型。<code>flags</code> 占 16 位，是标志(或者说属性)的集合，总共有十个标记。下面再补上 DNS 响应来一并讲解 <code>flags</code>:</p><blockquote><p>Tips: DNS 协议分请求报文和响应报文。在面板上的 <code>No.</code> 一栏中两个箭头代表着查询发出与响应返回，具有对应关系。<br>在 Wireshark 面板下，Flags 内每一行代表着一个属性说明，看上去还是挺工整的。</p></blockquote><img data-src="/blog/2018/04/06/URL-to-browser/dns-res.png"><ul><li>第一个标志 <code>QR(Query / Response)</code> 占 1 个位，代表本条消息是查询(query, 0), 还是响应(response, 1)。</li><li>第二个标志是操作码(<code>OpCode</code>)占 4 位。不管是响应和查询，全零都代表是标准查询。</li><li>第三个标志 <code>AA(Authoritative Answer)</code> 占 1 位，代表着授权回答。这个标志在上图的查询中没有显示出来是因为该标志只对响应有用。</li><li>第四个标志<code>TC(TrunCation)</code>占 1 位，代表该消息是不是“可截断的”。<code>1</code> 代表可截断，<code>0</code> 为不可截断。</li><li>第五个标志位 <code>RD(Recursion desired)</code> 表示“期望递归”，占 1 位，它告诉服务器执行递归执行。图中查询和响应的标志位被设为 <code>1</code>, 意味着以递归方式进行查询。</li><li>第六个标志位 <code>RA(Recursion available)</code> 占 1 位，如果服务器支持递归查询，将会在响应中设置该标志。本地 DNS 服务器一般是使用迭代方式进行查询，而根服务器仅支持迭代查询。</li><li>第七个标志位 <code>Z</code> 占 1 个比特位，该标志是保留字段，以供未来使用。</li><li>第八个标志位 <code>AD(Answer authenticated)</code> 占 1 位。如果包含的消息已授权，则该标志位会被设为 <code>1</code>。如果禁用安全检查，则下一个标志位 <code>CD</code> 会被设置为 <code>1</code>.</li><li>第九个标志位 <code>CD(Checking Disabled)</code> 占 1 位，该指示发送查询的解析器是否可以接受未经身份验证的数据。设置 <code>1</code> 为禁用安全检查接受未经身份验证的数据，设置 <code>0</code> 则不接受未经验证的数据，</li><li>第十个标志位 <code>RCODE(Response Code)</code> 占 4 位，表示响应的状态码，全零意味着没有错误(Not Error)。</li></ul><p>除了 <code>flags</code> 外，下面还有请求数(<code>Questions</code>)、回答记录数(DNS 消息格式示意图中的 <code>ANCOUNT</code>，Wireshark 上的 <code>Answer RRs</code>。其中 <code>RRs</code> 全称为 <code>Resource Records</code>，也就是资源记录)、授权记录数(<code>Authority RRs</code>)、其他额外信息数(<code>Additional RRs</code>)，这些都是字面意思，不过多解释。</p><img data-src="/blog/2018/04/06/URL-to-browser/dns-other-info.png"><p>在查询与响应中，我们可以看到有相同的 <code>Queries</code>，<code>Queries</code> 中有一个询问(<code>Querie</code>)。对于 DNS 查询意味着 DNS 客户端问 DNS 服务端问题，期望从它那边得到 <code>www.zhihu.com</code> 的 IP 地址。要求去 <code>IN(互联网)</code> 类中找到 <code>A 类型(IPv4 地址记录)</code> 的信息。对于 DNS 响应来说，这只是从查询那里拷贝过来的副本。</p><img data-src="/blog/2018/04/06/URL-to-browser/dns-queries.png"><p>关于 <code>class</code> 可以在下表中找到对应的含义。<code>type</code> 类型略庞大，笔者仅从维基百科截取其中一部分:</p><img data-src="/blog/2018/04/06/URL-to-browser/dns-table-class.png"> <img data-src="/blog/2018/04/06/URL-to-browser/dns-table-type.png"><p>DNS 响应中还会有 <code>Answers</code> 这个属性，代表着它对 <code>Queries</code> 给出的答案:</p><img data-src="/blog/2018/04/06/URL-to-browser/dns-res-answers.png"><p>在 <code>Answers</code> 中有三个域名、多条记录。</p><ul><li>域名 1 是 <code>www.zhihu.com</code>, 它设置了 CNAME，通过别名映射到了 <code>www.zhihu.com.dsa.dnsv1.com</code> 中。</li><li>域名 2 是 <code>www.zhihu.com.dsa.dnsv1.com</code>，从该域名的后缀可以得知知乎使用了腾讯云的动态加速域名(<code>*.dsa.dnsv1.com</code>)。知乎在腾讯云 DSA 控制台接入加速域名后，系统会为加速域名分配一个 “CNAME 域名”。随后该域名又通过 CNAME 映射到 <code>1442234.dsa.p23.tc.cdntip.com</code>。</li><li>(<code>.dsa.p23.tc.cdntip.com</code>)。</li><li>域名 3 是 <code>1442234.dsa.p23.tc.cdntip.com</code>，该域名下配置有多个 IPv4 地址，这些 IP 地址都是腾讯云为知乎提供的加速节点。这些 IP 地址会根据接入网络不同而动态变化。</li></ul><p>通过上面一系列的小步骤客户端得到了其中一个节点的 IP 地址，也就是 <code>183.232.152.114</code>。浏览器拿到 IP 地址后可以进行下一步的处理。</p><p>下面来对本地 DNS 查询做一个简单的总结:</p><ul><li>浏览器发起查询请求。浏览器所在的主机作为 DNS 客户端向本地 DNS 服务器发送查询请求。</li><li>本地 DNS 服务器找缓存。在该步骤上找到了 <code>www.zhihu.com</code> 的记录，于是将记录作为响应返回主机。</li></ul><p><strong>四、</strong> 能走到步骤四意味着在本地 DNS 服务器上也没有找到相应的记录。这时本地 DNS 服务器不会立即反馈给客户端它没货，而是将该查询转发至 ISP 提供的 DNS 服务器(缓存/转发服务器。笔者使用的是移动的网络，那就在移动的 DNS 服务器上找缓存)上查询。</p><p>下例将通过 <code>dig</code> 命令来查找 DNS，使用 <code>+trace</code> 参数指定从根名称服务器的委派路径到 <code>www.zhihu.com</code> 的跟踪。此例中发起查询请求的是本地 DNS 服务器(<code>172.20.10.1</code>)，但在实际域名解析中可能是由本地 DNS 服务器发送给 ISP DNS 服务器，再由 ISP DNS 服务器去向外查找。</p><p>顺带一提，<code>dig</code> 命令还可以使用 <code>@DNS服务器</code> 指定 DNS 服务器来做进行查询解析，如指定 google 的 DNS 服务器可以添加参数 <code>@8.8.8.8</code>。</p><p>下面还是以默认的 DNS 服务器进行解析，<code>dig</code> 命令在 unix 上是读取 <code>/etc/resolv.conf</code> 上的配置:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"># 若想指定谷歌的 DNS 服务器，那就在命令行输入:</span><br><span class="line"># dig @8.8.8.8 +trace www.zhihu.com</span><br><span class="line"></span><br><span class="line">➜  blog git:(master) ✗ dig +trace www.zhihu.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; +trace www.zhihu.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">.                       2364    IN      NS      k.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      l.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      c.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      m.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      i.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      j.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      h.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      b.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      f.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      g.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      e.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      a.root-servers.net.</span><br><span class="line">.                       2364    IN      NS      d.root-servers.net.</span><br><span class="line">;; Received 239 bytes from 172.20.10.1#53(172.20.10.1) in 5 ms</span><br><span class="line"></span><br><span class="line">com.                    172800  IN      NS      l.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      b.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      c.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      d.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      e.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      f.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      g.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      a.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      h.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      i.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      j.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      k.gtld-servers.net.</span><br><span class="line">com.                    172800  IN      NS      m.gtld-servers.net.</span><br><span class="line">com.                    86400   IN      DS      30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766</span><br><span class="line">com.                    86400   IN      RRSIG   DS 8 1 86400 20191213050000 20191130040000 22545 . BIozVERNebmR+7eHRoc&#x2F;OdIMRMWX54unL5wW9wP6t16pfJ+CKswMl8cv YFVeJv0wBBDEbh9mKan5iJqDaWzEm&#x2F;ovgHWTJpP5EIuWJiV+Mi+LIhCI nw0zKYEL5QcPTIB3p6lxC5U7ngakgj4LX7eJZ8kIYocyBTZBKZHSCQh6 GCXAX6zJihuRDiFoC3OtXdhVGlrEIYeRX8FY+CUsPMLbGg4&#x2F;JSeTNMH8 cFFFqw&#x2F;4fbcKxq8xstRO5H40TKfFl7DtESDBahf2mjC9byjdpU5vteoH rIez3APISqKq2HJ9fBqDTkkjwkFMDy264MnGQjSSyZ3kvL&#x2F;DYvV0qios 6pQVLw&#x3D;&#x3D;</span><br><span class="line">;; Received 1173 bytes from 192.5.5.241#53(f.root-servers.net) in 91 ms</span><br><span class="line"></span><br><span class="line">zhihu.com.              172800  IN      NS      ns3.dnsv5.com.</span><br><span class="line">zhihu.com.              172800  IN      NS      ns4.dnsv5.com.</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A  NS SOA RRSIG DNSKEY NSEC3PARAM</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20191205054917 20191128043917 12163 com. ieaNZWBhpQYmsLR87RZURry7wNE+u9MlGQCA0q70qKsEWyDZ9QLQeB5f YO+KOK5xFOs6wKSYBAOg+rM+E4xKQZpg3&#x2F;bBy5JSJVz1Pb6vfR1KHipW Zpqe5j0ehBJHOzTiLCauoSztU02rMIEr857hOWRzqapxZ0HKri8nm62l 1LRCrw&#x2F;NMajpndWovkdqb9tMkibas&#x2F;REg5yGShiFf&#x2F;H3fw&#x3D;&#x3D;</span><br><span class="line">5NHJE6K0NQHV1589FOR75DMTDH32O109.com. 86400 IN NSEC3 1 1 0 - 5NHJVBH070QGDCJIE8E8GBT5KO0AER7R  NS DS RRSIG</span><br><span class="line">5NHJE6K0NQHV1589FOR75DMTDH32O109.com. 86400 IN RRSIG NSEC3 8 2 86400 20191204062552 20191127051552 12163 com. bS8kkx0QB2FpCHxscssiDYzIOgwj1ff1mN3+whV9CR1hWZnBWiZ51NW1 vVVBrkdOipkAkqS1mBXqQ&#x2F;3FMzjhyS7BJxu3VTv83IPCh5VHi3GahGsQ xpRaMJy07bJ94jnL85U260Etzqwp6Lh&#x2F;uk2lIaa39searrlHj7mz1dvr zB8zW+yfnIN3cQYVSPc+7CToo4ALJg0i9KC8aanCnHc38g&#x3D;&#x3D;</span><br><span class="line">;; Received 969 bytes from 192.12.94.30#53(e.gtld-servers.net) in 568 ms</span><br><span class="line"></span><br><span class="line">www.zhihu.com.          600     IN      CNAME   www.zhihu.com.dsa.dnsv1.com.</span><br><span class="line">zhihu.com.              86400   IN      NS      ns3.dnsv5.com.</span><br><span class="line">zhihu.com.              86400   IN      NS      ns4.dnsv5.com.</span><br><span class="line">;; Received 137 bytes from 182.254.20.44#53(ns4.dnsv5.com) in 68 ms</span><br></pre></td></tr></table></figure><p>在上面的日志可以看出，名称解析是从右向左进行解析的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">now location: www.zhihu.com.</span><br><span class="line">                           ^</span><br></pre></td></tr></table></figure><p>最先查找的是根名称服务器。<code>172.20.10.1</code> (本地 DNS 服务器)逐个询问根域名服务器(根名称服务器地址全球只有 13 个)：“朋友，你知道 <code>www.zhihu.com</code> 的 IP 地址是什么？”。根名称服务器收到该询问后，若它自己不知道关于 <code>www.zhihu.com</code> 的相关信息，它直接告诉发起查询请求的 <code>172.20.10.1</code> 说它不清楚。那 <code>172.20.10.1</code> 就会询问下一个根名称服务器。这一个查询过程就由递归解析变为了迭代解析。</p><p>在不断的根域名迭代查询后，终于有根域名服务器知道我们想要查询域名的信息：</p><ul><li><code>172.20.10.1</code>: “朋友，你知道 <code>www.zhihu.com</code> 的 IP 地址是什么？”</li><li><code>f.root-servers.net</code>: “虽然我不知道具体地址映射，但你可以从 <code>COM TLD</code> 找到相关的线索。我有 <code>COM TLD</code> 的地址，你可以去问问他们”</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">now location: www.zhihu.com.</span><br><span class="line">                        ^^^^</span><br></pre></td></tr></table></figure><p><code>172.20.10.1</code> 在跟域名服务器(<code>f.root-servers.net</code>)上拿到了 <code>gTLD</code> 服务器信息，这些服务器的名称都是像 <code>l.gtld-servers.net.</code>、<code>b.gtld-servers.net.</code> 的格式。</p><p><code>172.20.10.1</code> 为了得到满足我们的需求还是得逐个拜访这些顶级域名服务器(os: 没办法，托人办事就是这样的)。询问的方式跟上面访问根域名服务器类似，直到问到了合适的人(<code>e.gtld-servers.net</code>)。</p><ul><li><code>172.20.10.1</code>: “朋友，你知道 <code>www.zhihu.com</code> 的 IP 地址是什么？”</li><li><code>e.gtld-servers.net</code> : “我这边有 <code>zhihu.com.</code> 的记录，我把它的联系方式给你，你问问它”。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">now location: www.zhihu.com.</span><br><span class="line">                  ^^^^^^^^^^</span><br></pre></td></tr></table></figure><p>从 <code>e.gtld-servers.net</code> 返回了 <code>zhihu.com.</code> 的相关消息。但还得继续迭代查询 <code>www.zhihu.com.</code> 的消息，最终在 <code>ns4.dnsv5.com</code> 找到了我们的目标信息。</p><p>虽然 <code>172.20.10.1</code> 拿到了 <code>www.zhihu.com.</code> 的信息，但它发现这是一条 <code>CNAME</code> 记录，它被映射到了 <code>www.zhihu.com.dsa.dnsv1.com.</code> 域名上。这意味着如果 <code>www.zhihu.com.dsa.dnsv1.com.</code> 没有再通过 CNAME 映射到别的域名上的话，那 <code>172.20.10.1</code> 想要找的 IP 地址就是 <code>www.zhihu.com.dsa.dnsv1.com.</code> 的 IP 地址。若有再映射，就继续查找，直到找到没有再被映射的域名，最后再将该结果返回。</p><p>至于为什么会映射到 <code>www.zhihu.com.dsa.dnsv1.com.</code>，前文已经讲解过，此处就不再重复赘述。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">now location: www.zhihu.com.</span><br><span class="line">              ^^^^^^^^^^^^^^</span><br></pre></td></tr></table></figure><p>从上面的几个大步骤可以看出：从客户端与本地 DNS 服务器的查询是属于递归查询，而 ISP DNS 服务器与外部 DNS 服务器之间的查询一般都是迭代查询。</p><p><strong>本章参考资料:</strong></p><ul><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Hosts_(file)">hosts | wikipedia</a></li><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Dig_(command)">dig</a></li><li><a target="_blank" rel="noopener" href="https://www.inacon.de/ph/data/DNS/Header_fields/index.php">DNS Header Section Format</a></li><li><a target="_blank" rel="noopener" href="https://mc.qcloudimg.com/static/qc_doc/492628ec6c21cec4a33f3274e11be31c/doc-Dynamic+Site+Accelerator-Glossary.pdf">腾讯云动态加速网络</a></li><li>《TCP/IP 详解 卷一: 协议》第十一章</li></ul><hr><h2 id="TCP-连接"><a href="#TCP-连接" class="headerlink" title="TCP 连接"></a>TCP 连接</h2><blockquote><p>世界上几乎所有的 HTPP 通信都是由 TCP/IP 承载的，TCP/IP 是全球计算机及网络设备都在使用的一种常用的分组交换网络分层。 HTTP 的连接实际上就是 TCP 连接以及其使用规则。 –《HTTP 权威指南》</p></blockquote><p>紧接着，浏览器拿到知乎的 IP 地址(<code>183.232.171.254</code>) 后， 浏览器取出 URL 的端口(HTTPS 的默认端口为 <code>443</code>)。</p><p>随即浏览器会创建新的套接字（socket）向 <code>183.232.171.254:443</code> 发起 <code>TCP</code> 连接请求:</p><p>建立 TCP 连接时会经历<strong>三次握手</strong>：</p><img data-src="/blog/2018/04/06/URL-to-browser/tcp-1.png" title="TCP 三次握手"><ol><li>首先浏览器作为客户端会发送一个小的 TCP 分组，这个分组设置了一个特殊的 <code>SYN</code> 标记，用来表示这是一条连接请求。同时设置初始序列号为 <code>x</code> 赋值给 <code>Seq</code>(这次捕获组的数据为: SYN=1, Seq=0)。</li><li>服务器接受到客户端的 <code>SYN</code> 连接后，会选择服务器初始序号 <code>y</code>。同时向客户端发送含有连接确认(<code>SYN+ACK</code>)、<code>Seq=0</code> (本例中的服务器初始序号)、<code>Ack=1</code> (客户端的序号 x + 1) 等信息的 TCP 分组。</li><li>客户端收到了服务器的确定字段后，向服务器发送带有 <code>ACK=1</code>、<code>Seq=1</code> (x+1)、<code>Ack=1</code> (服务器 Ack 信息的拷贝)等字段的 TCP 分组给服务器。</li></ol><p>以上每一个步骤相当于是一次握手。为了确保连接双方彼此完全清除对方的状况(初始序列号等)，那么三次握手缺一不可。</p><p>若在第二次握手时，服务器发送的 TCP 分组由于某些原因导致客户端没有正确的接受到，此时客户端没有接受到第二次握手的控制信息，而服务器认为已经正常连接了。这时双方对丢失数据这一情况是无法感知的，连接就无法建立。因此三次握手还是必要的。</p><p><strong>本章扩展资料:</strong></p><ul><li>《TCP/IP 详解 卷一: 协议》</li></ul><hr><h2 id="HTTPS-SSL-TSL"><a href="#HTTPS-SSL-TSL" class="headerlink" title="HTTPS (SSL/TSL)"></a>HTTPS (SSL/TSL)</h2><p>建立起连接后理论上就通过 HTTP 传输数据啦。但由于 <code>HTTP</code> 传输数据时报文是完全透明的，因此知乎使用了 <code>HTTPS</code> (HTTP Secure)，也就是在 TCP 与 HTTP 之间多添加一层协议做加密及认证的服务。</p><p><code>HTTPS</code> 使用 <code>SSL(Secure Socket Layer)</code> 和 <code>TLS(Transport Layer Security)</code> 协议，TCP 直接与 <code>SSL/TSL</code> 进行通信，<code>SSL/TSL</code> 再与 <code>HTTP</code> 协议进行通信，保障了信息的安全。</p><p><code>HTTPS</code> 建立通信需要一些过程，我们配通过捕获组可以看到使用 <code>TLSv1.2</code> 的连接过程：</p><ol><li><p>首先客户端发送 <code>Client Hello</code> 报文开始通信，该消息包括密码套件列表以及客户端随机数。</p><img data-src="/blog/2018/04/06/URL-to-browser/tls-1.png"></li><li><p>服务器接收到报文后返回 <code>Server Hello</code> 作为应答，该消息包括其选定的密码套件和服务器随机数</p></li><li><p>接着发送包含公开密匙证书的 <code>Certificate</code>。</p></li><li><p>服务器使用 <code>Diffie-Hellman</code> 密钥交换。获取客户端和服务器的随机数以及将用于计算会话密钥的 <code>DH</code> 参数，并使用其私钥对其进行加密，发送<code>Server Key Exchange</code>。</p></li><li><p>服务器发送 <code>Server Hello Done</code> 等待客户端响应。</p><img data-src="/blog/2018/04/06/URL-to-browser/tls-2.png"></li><li><p>客户端使用之前交换的 DH 参数来获取 <code>Pre-master Secret</code>，发送 <code>Client Key Exchange</code>。</p></li><li><p>客户端发送 <code>Change Cipher Spec</code> 指示服务器使用后续的密钥和算法加密发送后续消息。</p></li><li><p>客户端使用刚刚由 <code>DH</code> 协商出来的对称密钥加密通信报文，发送 <code>Encrypted Handshake Message</code> (finish message)，如果这个报文加解密校验成功，那么就说明对称秘钥是正确的。</p><img data-src="/blog/2018/04/06/URL-to-browser/tls-3.png"></li><li><p>服务器验证客户端的信息后，会发送 <code>New Session Ticket</code> 来更新客户端的 <code>session ticket</code>。<code>session ticket</code> 是对话密钥(session key)和加密方法经过加密后的信息，它由服务器生成，由客户端储存。</p></li><li><p>服务器发送 <code>Change Cipher Spec</code> 消息，通知客户端已更改加密规范。</p></li><li><p>发送 <code>Encrypted Handshake Message</code>，完成服务器握手。</p></li><li><p>接着就可以发送应用数据了。</p></li></ol><img data-src="/blog/2018/04/06/URL-to-browser/tls-4.png"><p><strong>本章参考资料:</strong></p><ul><li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc5246">RFC 5246</a></li><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange">Diffie-Hellman 密钥交换</a></li><li>《图解 HTTP》</li></ul><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>通过 <code>SSL/TSL</code> 进行安全传输后，客户端发起了 <code>HTTP</code> <code>GET</code> 请求。服务器读取请求后，对 HTTP 请求进行处理。</p><p>服务器会判断请求是否合法，比如检查 <code>cookie</code> 信息，看用户是否有权访问这个资源。再根据请求类型做相应处理，最终会将处理结果以及 <code>HTTP</code> 状态码返回给客户端。</p><p><code>www.zhihu.com</code> 是需要登录后才能访问的，登录过程大致如下:</p><ol><li>用户在页面输入账号密码点击登录，浏览器会通过 <code>HTTP POST</code> 提交用户信息给服务端。</li><li>服务端接收到用户提交的登录请求后，会验证账号密码是否正确，若正确会在 HTTP 头部通过 <code>set-cookie</code> 设置 <code>sessionID</code> 来标识用户是否登录。下次客户端请求服务器资源时，会自动携带这些 <code>cookie</code> 信息，服务器再通过 <code>sessionID</code> 来判断请求的人是谁。注意，<code>sessionID</code> 这字段是业界公认用于标识用户信息的字段，具体实现时也可以换一个字段名。</li><li>浏览器根据服务端返回的结果做相应的反应，如若登录成功，一般会通过重定向将用户带到指定的页面上。</li></ol><p>以上是比较通用的登录流程，笔者没有去抓包来验证知乎具体的登录方案。</p><p>我们可以打开浏览器匿名模式(此时匿名模式没有 cookie 缓存)，直接访问 <code>www.zhihu.com</code> 没有登录信息浏览器会返回 <code>302</code> (临时重定向) 会被重定向 <code>https://www.zhihu.com/signin?next=%2F</code> 这个登录页上。</p><img data-src="/blog/2018/04/06/URL-to-browser/http-1.png" title="被重定向前"> <img data-src="/blog/2018/04/06/URL-to-browser/http-2.png" title="被重定向后"><p>由此可以看出 <code>HTTP</code> 状态码与 <code>HTTP</code> 方法在浏览器与服务器通信之间的重要作用，下面介绍些常用的状态码与方法:</p><table><thead><tr><th>HTTP Method(方法)</th><th>解释</th></tr></thead><tbody><tr><td>GET</td><td>该方法用来请求访问已被 URI 识别的资源。我们直接在浏览器地址上输入合法的 URL 后，浏览器就会发出一个 <code>GET</code> 请求。</td></tr><tr><td>HEAD</td><td>与 <code>GET</code> 方法类似，只不过 <code>HEAD</code> 只会返回头部信息，不带回资源实体。</td></tr><tr><td>POST</td><td>向指定资源提交数据，请求服务器进行处理。比如提交 <code>form</code> 表单，提交较为复杂的参数的。</td></tr><tr><td>PUT</td><td>向指定资源位置上传其最新内容。</td></tr><tr><td>DELETE</td><td>请求服务器删除指定资源。</td></tr><tr><td>OPTIONS</td><td>预检请求，该方法可使服务器传会资源所支持的所有请求方法。</td></tr></tbody></table><p><code>HTTP</code> 状态码可以通过首位数字区分状态码大致是属于什么类型的：</p><table><thead><tr><th>HTTP status(状态码)</th><th>解释</th></tr></thead><tbody><tr><td>1xx</td><td>消息</td></tr><tr><td>2xx</td><td>成功</td></tr><tr><td>3xx</td><td>除了 <code>304</code> 状态码，其他大多与重定向相关</td></tr><tr><td>4xx</td><td>客户端错误</td></tr><tr><td>5xx</td><td>服务端错误</td></tr></tbody></table><p>日常工作中常见状态码：</p><table><thead><tr><th>HTTP status(状态码)</th><th>解释</th></tr></thead><tbody><tr><td>200 (ok)</td><td>请求成功</td></tr><tr><td>301 (Move Permanently)</td><td>永久重定向，表示这资源搬家了，你去 <code>location: //xxx.com</code> 可以找到它</td></tr><tr><td>302 (Found)</td><td>临时重定向。该资源可能临时出门旅游了，你可以先去 <code>location: //xxx.com</code> 看看情况。晚些时候它也可能会回来，也可能跑路了</td></tr><tr><td>304 (Not Modified)</td><td>客户端发送 <code>GET</code> 请求时，服务器通过请求头部信息发现请求的资源跟以前请求的那份一样，没有发生改变。然后服务端会返回 <code>304</code> 状态码并对客户端说：<code>你想要的资源跟以前一样，你直接用缓存的文件吧，货我就不给你，毕竟寄东西是需要邮费</code></td></tr><tr><td>400 (Bad Request)</td><td>客户端向服务器发送的请求报文中存在语法错误，服务器看不懂就会返回 <code>400</code> 状态码并对客户端说: “朋友，现在我再给你一次组织语言的机会，你仔细瞧瞧是不是漏了点啥”</td></tr><tr><td>401 (Unauthorized)</td><td>未认证，客户端向服务器请求的资源需要认证信息，客户端没有认证信息</td></tr><tr><td>403 (Forbidden)</td><td>服务器已经理解请求，但是拒绝执行它。(大灰狼: “小白兔开门，我给你叔叔的妹夫的堂兄呀！我跟你爹可是熟人”；小白兔：”大坏蛋，你休想骗我开门！“)</td></tr><tr><td>404 (Not Found)</td><td>请求失败，请求所希望得到的资源未被在服务器上发现。也有可能是资源存在，但服务器不想给你就假装不在。(某天你想拜访旧友，发现人家拆迁了，甚至楼都被铲平了)</td></tr><tr><td>500 (Internal Server Error)</td><td>服务器抛错，无法正常完成请求的处理。有可能有 bug、也可能是其他原因</td></tr><tr><td>503 (Service Unavailable)</td><td>由于临时的服务器维护或者过载，服务器当前无法处理请求。这个状况是暂时的，并且将在一段时间以后恢复。访问页面遇到此错误多数情况下是正在部署页面</td></tr><tr><td>504 (Service Unavailable)</td><td>作为网关或者代理工作的服务器尝试执行请求时，未能及时从上游服务器或者辅助服务器收到响应。</td></tr></tbody></table><p>由于笔者目前的环境上没有屏幕录制工具，这里就直接用笔者以前录制的旧图来演示。下面是调整网络速度后访问掘金首页的所发起 <code>HTTP</code> 加载过程:</p><img data-src="/blog/2018/04/06/URL-to-browser/anima-2.gif" title="访问掘金首页"><p>在输入网址后，浏览器向服务端发起请求，服务端会将目标资源通过 <code>HTTP</code> 返回，浏览器解析文档时，再一次根据文档里的(link 或者 script 标签)进一步请求外部资源（详情放在下面再说）.</p><p>我们可以在<strong>Network</strong>上看到，浏览器将请求发出去后，请求的<code>status</code>会变为<code>pending</code>，这也是上面说到开始建立连接请求的第一步，正在等待服务器的回应。随即我们点进请求详情内，可以发现请求头只有少量的字段。</p><p>我们再打开一个请求状态（status）为 200 的请求，就能看到完整的请求头以及服务端传回来的响应了.</p><p><strong>扩展资料:</strong></p><ul><li>《图解 HTTP》</li><li>《HTTP 权威指南》</li></ul><hr><h2 id="渲染文档"><a href="#渲染文档" class="headerlink" title="渲染文档"></a>渲染文档</h2><p>浏览器开始解析页面，不同的浏览器引擎渲染过程都不太一样，这里以 <code>webkit内核</code> 的渲染方式为例：</p><ol><li><p>首先浏览器的 HTML 解释器（HTML Parser）先工作，它将 HTML 的标签解析为 DOM 树。（DOM 树构建）.</p><p>如果遇到了<code>&lt;script&gt;</code>标签则会停止解析文档，这是因为 JavaScript 中可能会带有<code>document.write</code>方法，可能会重写页面的结构，因此浏览器会等待<code>script</code>标签下载完毕并执行后才会继续解析文档。</p><p>这也是著名的 web 开发最佳实践的规则之一的由来————将<code>&lt;script&gt;</code>放在<code>&lt;body/&gt;</code>之上，这样就不会阻塞文档解析了。</p></li><li><p>接着 css 解析器（CSS Parser）会在 DOM 树构建完毕后开始解析 css，它和 DOM 树一样最后解析出来的是树形结构的<strong>CSSOM</strong>（css object module，别名也要 StyleRules），浏览器将解析后的样式信息保存到新建的<code>RenderStyle</code>对象中。</p></li><li><p><code>RenderStyle</code>对象被<code>RenderObject</code>类所管理和使用.</p></li><li><p>当创建 RenderObject 对象之后，每个对象是不知道自己的位置、大小等信息的，webkit 根据盒模型来计算他们的位置、大小等信息，这个过程也被称之为回流与重绘（reflow and reflow）.</p></li><li><p>页面呈现.</p></li></ol><p>下图是 <code>Mozilla</code> 官网的页面渲染的过程:</p><img data-src="/blog/2018/04/06/URL-to-browser/Mozilla.gif"><hr><h2 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h2><ul><li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Performance/How_browsers_work">渲染页面：浏览器的工作原理</a></li></ul><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>本篇文章是笔者去年初写的了。由于最近几个月都在研究计算机底层的知识，因此想借此机会重构本篇文章。</p><p>由于现实工作的缘故，目前只来得及对大部分内容进行重写，本篇后期一些内容讲的比较简单，如果之后还有空的话会继续重构。</p><p>本文主要是通过笔者现有的知识体系进行概括性科普，若有内容表达得不对，欢迎在评论区或私信指正~如果想更深入的学习计算机底层的知识，建议通过专业的教材进行系统的学习。本文各章下都有参考资源与推荐阅读，有兴趣的朋友可以去了解一下。</p><p>最后欢迎读者朋友们订阅笔者博客。整理学习笔记不易，不点个赞鼓励一下笔者再走吗~</p><ul><li><a href="https://anran758.github.io/blog/atom.xml">Blog RSS</a> 笔者博客的 rss 订阅链接</li><li><a target="_blank" rel="noopener" href="https://github.com/anran758/Front-End-Lab">Front-End-Lab</a> 笔者的知识碎片库</li></ul><p><img data-src="https://pic1.zhimg.com/80/v2-7c35091abc2379395b66118e9740d024_hd.png" alt="耶!"></p><hr><p><strong>更新日志:</strong></p><ul><li>2019.12.07: 重构大纲</li><li>2021.05.06: 补充简短版与扩展阅读</li></ul></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-date">2019-07-16</div><div class="popular-posts-title"><a href="/blog/2019/07/16/ant-design-redirect-change-method/" rel="bookmark">Ant Design Pro 使用 no-mock 造成 POST 请求被重定向为 GET 请求</a></div></li><li class="popular-posts-item"><div class="popular-posts-date">2017-12-25</div><div class="popular-posts-title"><a href="/blog/2017/12/25/初窥Web-Sockets/" rel="bookmark">初窥WebSockets</a></div></li></ul><div class="reward-container"><div></div><div style="color:grey">「请笔者喝杯奶茶鼓励一下」</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>Donate</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/blog/images/qrcode/wechatpay.png" alt="anran758 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/blog/images/qrcode/alipay.png" alt="anran758 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>anran758</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://anran758.github.io/blog/2018/04/06/URL-to-browser/" title="初识网络原理: 从浏览器地址栏输入 URL 到页面渲染之间都经历了什么">https://anran758.github.io/blog/2018/04/06/URL-to-browser/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="https://zhuanlan.zhihu.com/c_1147180666474176512"><span class="icon"><i class="fab fa-zhihu"></i> </span><span class="label">知乎专栏</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/blog/tags/HTTP/" rel="tag"># HTTP</a> <a href="/blog/tags/TCP/" rel="tag"># TCP</a> <a href="/blog/tags/DNS/" rel="tag"># DNS</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/blog/2018/03/24/loading-pictures/" rel="prev" title="你可能不了解的图片加载方式"><i class="fa fa-chevron-left"></i> 你可能不了解的图片加载方式</a></div><div class="post-nav-item"><a href="/blog/2018/04/23/git-flow/" rel="next" title="git-flow 练习笔记">git-flow 练习笔记 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="tabs tabs-comment"><ul class="nav-tabs"><li class="tab"><a href="#comment-disqus">disqus</a></li><li class="tab"><a href="#comment-gitalk">gitalk</a></li></ul><div class="tab-content"><div class="tab-pane disqus" id="comment-disqus"><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></div><div class="tab-pane gitalk" id="comment-gitalk"><div class="comments" id="gitalk-container"></div></div></div></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%B0%E5%9D%80%E6%A0%8F"><span class="nav-number">2.</span> <span class="nav-text">地址栏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#URL"><span class="nav-number">3.</span> <span class="nav-text">URL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IP-%E5%9C%B0%E5%9D%80"><span class="nav-number">4.</span> <span class="nav-text">IP 地址</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#IPv4"><span class="nav-number">4.1.</span> <span class="nav-text">IPv4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%B1%BB%E7%BD%91%E7%BB%9C"><span class="nav-number">4.2.</span> <span class="nav-text">分类网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%88%86%E9%85%8D%E6%96%B9%E6%A1%88"><span class="nav-number">4.3.</span> <span class="nav-text">其他分配方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IPv6"><span class="nav-number">4.4.</span> <span class="nav-text">IPv6</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F-DNS"><span class="nav-number">5.</span> <span class="nav-text">域名系统(DNS)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS"><span class="nav-number">5.1.</span> <span class="nav-text">DNS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0-DNS"><span class="nav-number">5.2.</span> <span class="nav-text">本地 DNS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hosts"><span class="nav-number">5.3.</span> <span class="nav-text">hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="nav-number">5.4.</span> <span class="nav-text">域名解析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TCP-%E8%BF%9E%E6%8E%A5"><span class="nav-number">6.</span> <span class="nav-text">TCP 连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTPS-SSL-TSL"><span class="nav-number">7.</span> <span class="nav-text">HTTPS (SSL&#x2F;TSL)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP"><span class="nav-number">8.</span> <span class="nav-text">HTTP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%96%87%E6%A1%A3"><span class="nav-number">9.</span> <span class="nav-text">渲染文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB"><span class="nav-number">10.</span> <span class="nav-text">扩展阅读</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">11.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="anran758" src="https://avatars3.githubusercontent.com/u/23024075?s=96&v=4"><p class="site-author-name" itemprop="name">anran758</p><div class="site-description" itemprop="description">web 开发的碎碎念</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/blog/archives/"><span class="site-state-item-count">58</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/blog/categories/"><span class="site-state-item-count">22</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/blog/tags/"><span class="site-state-item-count">88</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/anran758" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;anran758" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://weibo.com/u/3833726651" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;3833726651" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a> </span><span class="links-of-author-item"><a href="https://segmentfault.com/u/anran758" title="Segmentfault → https:&#x2F;&#x2F;segmentfault.com&#x2F;u&#x2F;anran758" rel="noopener" target="_blank"><i class="fab fa-skype fa-fw"></i>Segmentfault</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/blog/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> 推荐阅读</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://www.zhangxinxu.com/" title="http:&#x2F;&#x2F;www.zhangxinxu.com&#x2F;" rel="noopener" target="_blank">张鑫旭</a></li><li class="links-of-blogroll-item"><a href="https://tan90qian.github.io/blog/" title="https:&#x2F;&#x2F;tan90qian.github.io&#x2F;blog&#x2F;" rel="noopener" target="_blank">Tan90Qian's blog</a></li><li class="links-of-blogroll-item"><a href="http://www.alloyteam.com/" title="http:&#x2F;&#x2F;www.alloyteam.com&#x2F;" rel="noopener" target="_blank">Alloyteam</a></li></ul></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> 常用网站</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://caniuse.com/" title="https:&#x2F;&#x2F;caniuse.com&#x2F;" rel="noopener" target="_blank">Caniuse(CSS兼容性)</a></li><li class="links-of-blogroll-item"><a href="https://developer.mozilla.org/zh-CN/" title="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;" rel="noopener" target="_blank">MDN(web 文档)</a></li><li class="links-of-blogroll-item"><a href="https://codepen.io/" title="https:&#x2F;&#x2F;codepen.io&#x2F;" rel="noopener" target="_blank">codepen</a></li><li class="links-of-blogroll-item"><a href="https://tinypng.com/" title="https:&#x2F;&#x2F;tinypng.com&#x2F;" rel="noopener" target="_blank">Tinypng(图片压缩)</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">anran758</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">290k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">6:03</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动</div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=5d560b378f0db5fa" async></script></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>!function(){function e(e){return e=encodeURI(e),document.getElementById(e).querySelector(".leancloud-visitors-count")}let{app_id:t,app_key:o,server_url:n}={enable:!0,app_id:"pzA3EVFcmmGjhOfofaeSXDdr-MdYXbMMI",app_key:"YQgLRTjAQ5uE0S4T6dKqeS8U",server_url:null,security:!0};function r(n){var r=(e,r,l)=>fetch(`${n}/1.1${r}`,{method:e,headers:{"X-LC-Id":t,"X-LC-Key":o,"Content-Type":"application/json"},body:JSON.stringify(l)});if(CONFIG.page.isPost){if(CONFIG.hostname!==location.hostname)return;!function(t){var o=document.querySelector(".leancloud_visitors"),n=decodeURI(o.id);o.dataset.flagTitle,t("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:n}))).then(e=>e.json()).then(({results:o})=>{if(o.length>0){var r=o[0];e(n).innerText=r.time+1,t("put","/classes/Counter/"+r.objectId,{time:{__op:"Increment",amount:1}}).catch(e=>{console.error("Failed to save visitor count",e)})}else e(n).innerText="Counter not initialized! More info at console err msg.",console.error("ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.")}).catch(e=>{console.error("LeanCloud Counter Error",e)})}(r)}else document.querySelectorAll(".post-title-link").length>=1&&function(t){var o=[...document.querySelectorAll(".leancloud_visitors")].map(e=>decodeURI(e.id));t("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:{$in:o}}))).then(e=>e.json()).then(({results:t})=>{for(let n of o){let o=t.find(e=>e.url===n);e(n).innerText=o?o.time:0}}).catch(e=>{console.error("LeanCloud Counter Error",e)})}(r)}let l="-MdYXbMMI"!==t.slice(-9)?n:`https://${t.slice(0,8).toLowerCase()}.api.lncldglobal.com`;l?r(l):fetch("https://app-router.leancloud.cn/2/route?appId="+t).then(e=>e.json()).then(({api_server:e})=>{r("https://"+e)})}()</script></div></footer></div><script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script><script src="/blog/js/bookmark.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>CONFIG.page.isPost&&(wpac_init=window.wpac_init||[],wpac_init.push({widget:"Rating",id:20378,el:"wpac-rating",color:"fc6423"}),function(){if(!("WIDGETPACK_LOADED"in window)){WIDGETPACK_LOADED=!0;var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//embed.widgetpack.com/widget.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t.nextSibling)}}())</script><script src="/blog/js/local-search.js"></script><script>document.querySelectorAll("pre.mermaid").length&&NexT.utils.getScript("//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js",()=>{mermaid.initialize({theme:"default",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})},window.mermaid)</script><script>function loadCount(){var d=document,n=d.createElement("script");n.src="https://anran758.disqus.com/count.js",n.id="dsq-count-scr",(d.head||d.body).appendChild(n)}window.addEventListener("load",loadCount,!1)</script><script>var disqus_config=function(){this.page.url="https://anran758.github.io/blog/2018/04/06/URL-to-browser/",this.page.identifier="2018/04/06/URL-to-browser/",this.page.title="初识网络原理: 从浏览器地址栏输入 URL 到页面渲染之间都经历了什么"};NexT.utils.loadComments(document.querySelector("#disqus_thread"),()=>{if(window.DISQUS)DISQUS.reset({reload:!0,config:disqus_config});else{var e=document,t=e.createElement("script");t.src="https://anran758.disqus.com/embed.js",t.setAttribute("data-timestamp",""+ +new Date),(e.head||e.body).appendChild(t)}})</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>NexT.utils.loadComments(document.querySelector("#gitalk-container"),()=>{NexT.utils.getScript("//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js",()=>{new Gitalk({clientID:"a35e4aa0db5b5a7bcc2f",clientSecret:"a19ef2a9debab8747a6e723c1eff1141213fe101",repo:"gitment-comments",owner:"anran758",admin:["anran758"],id:"d87e9d8c51e161e089b872f6b0db087a",language:"",distractionFreeMode:!0}).render("gitalk-container")},window.Gitalk)})</script></body></html>